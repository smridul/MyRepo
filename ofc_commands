Skip to content
Enterprise
Search or jump to…

Pull requests
Issues
Explore
 @smridul Sign out
1
0 0 smridul/docs
 Code  Issues 0  Pull requests 0  Projects 0  Wiki  Insights  Settings
docs/commands
c4d1f71  on Feb 27
@smridul smridul Update commands
     
234 lines (108 sloc)  10.4 KB
Cheat sheet
==================



Ims related
================

To delete all association  of accounts with a number 
yosdbUtil -t OpenReg.HandleToGuid -r 2:A+1-4087699869 –d


//mobstor uploader, file is in r01.smoke.member.gq1.yahoo.com(also saved in this doc directory for safety).
//it should be added to role yahoo.mobstor.client.idms.prod
sudo php mobstor_uploader.php . idmsarmobile.zip


GUID to yid
yosdbUtil -t OpenReg.GuidToHandle -r  guidvalue



2SV feature implementation

curl -v https://r01gamma.member.gq1.yahoo.com/v1/api/conditioners/2sv/remove_forced --data-binary @2sv.txt -H "content-type:application/json" -H "Yahoo-App-Auth:`yca-cert-util -show | grep yahoo.membership.accountservice.rhel | cut -d ' ' -f2`" –k





Telesign Phone cache related

curl   -H "Yahoo-App-Auth:`yca-cert-util -show | grep socdir.yosgamma | cut -d ' ' -f2`" http://gamma-usnc1.dht.yahoo.com:4080/YDHTWebService/V1/delete/MembershipReg.TelesignCache/140




Modern stack

When seeing scoped cookie error while running local processor. Go to project structure. Exclude java folder from account_application service

Then run it. Then include it and again run it

Cukes running 
-DfunctionalTestTargetHostName=parksremarks.corp.ne1.yahoo.com:8006 -DfunctionalTestProtocolType=https

-DfunctionalTestTargetHostName=be.trunk.login.yahoo.com:4080 -DfunctionalTestProtocolType=http

Glue: com.yahoo.accounts.client.api.steps



yinst restore -igor -igor_tag membership.reg.master.build.201505141810  -host=r01gamma.member.ne1.yahoo.com



If facing evntlogger error due to new key added
then do this
rm -rf ~/.m2/repository/accounts/stats-event-logger/stats-event-logger/0.1-SNAPSHOT
run mvn clean install again. Also after this i have to copy settings.xml from my VM. But now i dont need to copy again

sudo yrbDbAdmin -c FLUSH


============================
PHONE COUNTERS
=============================
Alpha env
curl  http://gamma-usnc1.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.PhoneCounters/%2B14087699869

prod env (run on bvt)

curl  http://sherpa-bcp1904.dht.yahoo.com:4080/YDHTWebService/V1/delete/Membership.PhoneCounters/%2B14087699869   -H "Yahoo-App-Auth:`yca-cert-util -show | grep yahoo.membership.phonecounters.prod | cut -d ' ' -f2`"



============================
EMAIL COUNTERS
=============================
Alpha
curl  http://gamma-usnc1.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.EmailCounters/mridul.shriv@gmail.com

Stage (run this on bvt)
curl  http://int-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.EmailCounters/shrivastava.mradul@gmail.com   -H "Yahoo-App-Auth:`yca-cert-util -show | grep yahoo.membership.emailcounters.smoke | cut -d ' ' -f2`"


=============
User Counter 
===============
Alpha
curl  http://gamma-usnc1.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.UserNotificationCounters/4LXVWZEFJ66RJRMYLKXS4JGWAA

stage (runn in bvt)
curl  http://int-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.UserNotificationCounters/yqa_smridul16   -H "Yahoo-App-Auth:`yca-cert-util -show | grep yahoo.mbr.yca.account.svc-sherpa.env-smoke | cut -d ' ' -f2`" 


fetching new keys in VM
https://git.corp.yahoo.com/membership-platforms/accounts-java-ws/wiki/6.-Fetching-newly-created-ykeykey-to-Openstack-VM



clover build

mvn -Pcode-coverage -Dmaven.clover.jdk=1.8 -Dmaven.clover.generateXml=true -Dmaven.clover.generateHtml=true -Dmaven.clover.licenseLocation=/home/y/conf/clover/clover.license com.atlassian.maven.plugins:maven-clover2-plugin:4.0.4:instrument-test com.atlassian.maven.plugins:maven-clover2-plugin:4.0.4:aggregate com.atlassian.maven.plugins:maven-clover2-plugin:4.0.4:clover


Getting PR build from PR number


http://jenkins.pr.screwdriver.corp.yahoo.com:9999/jenkins/job/128264-v3-PR-5505/BUILD_CONTAINER=oracle-jdk8-current,label=DOCKER-LOW/

5505 is PR



//pwqa counter. go to r01.stage.member.gq1.yahoo.com

 curl  http://sherpa-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.ChallengeCounters/yqa_smridul16:pwqa:1   -H "Yahoo-App-Auth:`yca-cert-util -show | grep yahoo.membership.challengecounters.prod | cut -d ' ' -f2`"


Fixing the ssl issue while makeing cuke call to VM:

http://stackoverflow.com/questions/373295/digital-certificate-how-to-import-cer-file-in-to-truststore-file-using





//Equaivalent of yosdb utils from java vm (on openstack Vm)

[12:32 PM] Mridul Kumar Shrivastava:
    curl http://sherpa-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.Alpha_HandleToGuid/0:yqa_functest_14694743340856336 -H "Yahoo-App-Auth: `yca-cert-util -show | grep yahoo.membership.yosdb.alpha | cut -d ' ' -f 2`"  --proxy "yca-proxy.corp.yahoo.com:3128"
[12:33 PM] Mridul Kumar Shrivastava:
    curl http://sherpa-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/Membership.Alpha_HandleToGuid/2%3AA%2B1-8553941810 -H "Yahoo-App-Auth: `yca-cert-util -show | grep yahoo.membership.yosdb.alpha | cut -d ' ' -f 2`"  --proxy "yca-proxy.corp.yahoo.com:3128"
    
    
    
    
    
    
    To get guids from phone number in prod(run on r01.stage.ne1.edit.yahoo.com)
    
     curl http://sherpa-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/OpenReg.HandleToGuid/2%3AA%2B1-4087699869 -H "Yahoo-App-Auth: `yca-cert-util -show | grep yahoo.membership.yosdb.prod | cut -d ' ' -f 2`" |json_xs


   Get yids from guid
   curl http://sherpa-bcp1280.dht.yahoo.com:4080/YDHTWebService/V1/get/OpenReg.GuidToHandle/4ZGMXFANC453PRDHGZYDGUHJOY -H "Yahoo-App-Auth: `yca-cert-util -show | grep yahoo.membership.yosdb.prod | cut -d ' ' -f 2`" |json_xs
   
   httpReq.addHeader("y-ra", "10.91.14.137");
   
   
   index=mbr-stats (sourcetype=MH_jdisc_error OR sourcetype=jetty_server)  "/api/v1/users/authentication/credentials"
| rex field=_raw "(?<json_field>{.*})"
| spath input=json_field
| search eventdata.ep="/api/v1/users/authentication/credentials" AND username!=yqa* AND eventdata.auth_mech="SECONDARY"



index=mbr-stats host=pprd* "\"ep\":\"/api/v1/challenge/oldpassword" SECONDARY | rex field=_raw "(?<json>{.*})" | spath input=json | search eventdata.ctok_chal_st="SUCCESS" OR eventdata.ctok_chal_st="FAILURE"| eval AR_STEP = case(
    match('eventdata.ctok_chal_st',"SUCCESS"), "successful_oldpassword_challenge",
    match('eventdata.ep',"/api/v1/challenge/oldpassword/validate"), "total_oldpassword_challenge")| convert timeformat=%Y-%m-%d ctime(_time) AS Date | stats count(username) AS total, count(eval(AR_STEP="successful_oldpassword_challenge")) AS success by Date| eval percent_success=((success/total)*100) | table percent_success Date
    
    
    
    
    
    
    
    
    
    index=mbr-stats  host=pprd* SECONDARY "*" "\"ep\":\"/api/v1/users/authentication/credentials\"" ("\"itok_chal_type\":\"SUCCESS\""  OR "\"ctok_chal_type\":\"USERNAME\"" OR "\"ctok_chal_type\":\"RECAPTCHA\"" OR "\"ctok_chal_type\":\"CAPTCHA\"") "\"ctok_chal_st\":\"SUCCESS\"" |
    rex field=_raw "(?<json>{.*})" | spath input=json | search eventdata.auth_mech="secondary"  | rename eventdata.itok_chal_type as inittoken | convert timeformat=%Y-%m-%d ctime(_time) AS Date| rename eventdata.ctok_chal_type as comptoken | eval status=case(inittoken=="SUCCESS","SUCCESS",                                                                                                                                           comptoken=="RECAPTCHA" OR comptoken=="CAPTCHA", "USERNAME_SOLVED_WITH_CAPTCHA",                                                            comptoken=="USERNAME" AND !(inittoken=="RECAPTCHA" OR inittoken=="CAPTCHA") AND inittoken!="FAIL", "USERNAME_SOLVED_WITHOUT_CAPTCHA")|  
    stats dc(eventdata.B) as total by eventdata.auth_state_seq,status| xyseries eventdata.auth_state_seq status total | fillnull |
    eval PASS_RATE=SUCCESS/(USERNAME_SOLVED_WITH_CAPTCHA +USERNAME_SOLVED_WITHOUT_CAPTCHA) *100 | rename eventdata.auth_state_seq as sequence | fields sequence,PASS_RATE,SUCCESS,USERNAME_SOLVED_WITH_CAPTCHA, USERNAME_SOLVED_WITHOUT_CAPTCHA
    
    
    
    
    
   UDB API
   By usrname//
  
   curl  'https://gq1.api.udb.yahoo.com:4443/v2/users/yahoo/@me?YID=VBLDKLWEB5B5HXNRZAAG27ZCSLVOPKBBTHJEXWZG&fields=ym,aliases' -H "content-type: application-/json" -H "Yahoo-App-Auth: `yca-cert-util --show | grep mbr.yca.accountws.svc-udb.env-all | cut -d ' ' -f 2`" -kv
    
  
  By guid //
  curl  'https://gq1.api.udb.yahoo.com:4443/v2/users/6BZQJ42V4SFWWXSW2G77AFC6ZA?fields=ym,aliases,login' -H "content-type: application-/json" -H "Yahoo-App-Auth: `yca-cert-util --show | grep mbr.yca.accountws.svc-udb.env-all | cut -d ' ' -f 2`" -kv
  
  echo QWxhZGRpbjpvcGVuIHNlc2FtZQ== | base64 --decode
  
  
   TO check udb keys 
   curl 'https://gq1-alpha.api.udb.corp.yahoo.com:4443/v2/users/yahoo/@me?YID=yid&fields=demog,mbr_devices_data,ym' -H "Yahoo-App-Auth: `yca-cert-util --show | grep mbr.yca.edit.svc-udb.hgp-api.env-alpha | cut -d ' ' -f 2`" -kv



To check udb keys with cookies

curl 'https://gq1-alpha.api.udb.corp.yahoo.com:4443/v2/users/yahoo/@me?fields=demog,mbr_devices_data,ym' -H "Yahoo-App-Auth: `yca-cert-util --show | grep mbr.yca.edit.svc-udb.hgp-api.env-alpha | cut -d ' ' -f 2`" -kv  -H "Cookie: Y=v=1&np=1&n=15lcktovtna7q&l=b761x0l470pcj9f6ogjnvd69961hk4g80u7pl88x/o&p=f28000000000000&iz=95048&r=11t&lg=en-US&intl=us; T=z=2lGKZB2lGKZBBqXYLNV1Vqb&a=QAE&sk=DAAIZ.AX8iPKU3&ks=EAAH9POgfWw4Kcf5zYYecGHLQ--~E&ku=FAAkUgeaQUc1WB5hOE8bJb_Mmec4OsrC.EmGqlxEvRkPFGpMheywggC9aFscjnYN7gHP9kmUxuHSNM0eIlqeRWGuEkUVqzqowYL5Q.DP0CDUvfA25IpZy_5___MynnVbIN1IteA6Tj7X8KP49dy9GDFAq4hNUOg.qC_N7xtltl.13M-~B&d=ZwFETVc3RzJQRUpFSzM3UEJVSkVZRkc3NlJKSQFhAVFBRQFzYwF5cWEBZnMBcTlRb2ZlUlpLR2wy&af=JnRzPTE0OTU4MjA2NjImcHM9QnE0WFdxd1cxWHh5dk1aeThBQTl3dy0t; SSL=v=1&s=nbl_Jcs4U9zvNrDM9refOIgp73AdGrjSoMl4oIy1gFU6YzcVcbJZ9wWhdvDT7BRYAWnf1yOliAKHjjy9rBqX0A--&kv=0&ku=lMvyz.B8mh1Xi9rHRKHK4S2jWVeMcr9eYvyD6uRhGrxp5xcT8A1TaWhJFKzw74exG_JLuIznXEDJLYVq.W3jI.36ryGOm5Aqj2B.K_JR5xXiavVungz9p5CCKZn68xdLg9UfAurPGwdOvR2mfQyoz8Xsmlw0BjnZhQJLfsXeD0A-~B"

/Users/smridul/code/apache-maven-3.3.9/bin/mvn clean generate-sources

-----END RSA PRIVATE KEY----- to -----END PRIVATE KEY-----
sudo openssl pkcs8 -topk8 -inform pem -in /srv/credstore/etc/athens.key -outform pem -nocrypt -out private.key


Getting the TOP 10 lines of a file
 head -n 10 merged_accounts_wave1.csv
 
 Gettting all lines after line 'n'
 tail -n +9990 merged_accounts_wave1.csv
 
 
 split by charater ','
 cat ~/temp/merged_att_2nd |  awk -F"," '{print $1}'
 
 
 DIFF of files
 sort file1 >file1_sorted
 sort file2 > file2_sorted
 
 comm -3 file1_sorted file2_sorted
 
 HOSTS
 customudb02.member.gq1.yahoo.com
 
 
 
 check cuke failure:
 
 "at ?." PR build "at *." for trunk.
 
 
© 2019 GitHub, Inc.
Help
Support
API
Training
Blog
About
GitHub Enterprise 2.15.12
Press h to open a hovercard with more details.
